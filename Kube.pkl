module declix.podman.Kube

extends "@pkl-systemd/Unit.pkl"

unit: UnitSection?
install: InstallSection?
kube: KubeSection

// https://docs.podman.io/en/latest/markdown/podman-systemd.unit.5.html
local class KubeSection {
    // Path to Kubernetes YAML file (required)
    yaml: String
    
    // Automatic image updates
    autoUpdate: AutoUpdatePolicy?
    
    // ConfigMap YAML paths
    configMap: (String|Listing<String>)?
    
    // Network configuration
    network: String?
    
    // Expose ports from containers
    publishPort: (String|Listing<String>)?
    
    // Exit code propagation policy
    exitCodePropagation: ExitCodePolicy?
    
    // Working directory for relative paths
    workingDirectory: String?
    
    // User namespace mapping
    userNS: String?
    
    // Group ID mapping
    gidMap: (String|Listing<String>)?
    
    // User ID mapping
    uidMap: (String|Listing<String>)?
    
    // Security labels
    securityLabelType: String?
    securityLabelLevel: String?
    securityLabelDisable: Boolean?
    
    // Labels for the deployment
    label: Mapping<String, String>?
    
    // Annotations for the deployment
    annotation: Mapping<String, String>?
    
    // Volume mounts
    volume: (String|Listing<String>)?
    
    // Log driver
    logDriver: String?
    
    // Log options
    logOpt: (String|Listing<String>)?
    
    // Down timeout
    downTimeout: UInt?
    
    // Set working directory
    setWorkingDirectory: String?
    
    // Additional podman kube play options
    podmanArgs: String?
}

local typealias AutoUpdatePolicy = "registry" | "local"
local typealias ExitCodePolicy = "all" | "any" | "none"
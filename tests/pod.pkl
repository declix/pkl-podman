amends "pkl:test"

import "../Pod.pkl"

local fullPod = new Pod {
    unit = new {
        description = "Test Pod"
        after = "network.target"
    }
    
    pod = new {
        podName = "test-pod"
        network = "bridge"
        hostname = "test.local"
        exitPolicy = "stop"
        
        publishPort = new Listing {
            "8080:80"
            "8443:443"
        }
        
        dns = new Listing {
            "8.8.8.8"
            "8.8.4.4"
        }
        
        dnsOption = new Listing {
            "ndots:2"
        }
        
        dnsSearch = new Listing {
            "example.com"
        }
        
        volume = new Listing {
            "/var/log/test:/var/log:Z"
        }
        
        networkAlias = new Listing {
            "test-alias"
        }
        
        addHost = new Listing {
            "host1:192.168.1.1"
        }
        
        userNS = "keep-id"
        uidMap = new Listing {
            "0:100000:65536"
        }
        gidMap = new Listing {
            "0:100000:65536"
        }
        
        securityLabelDisable = false
        securityLabelType = "container_t"
        
        label {
            ["app"] = "test"
            ["environment"] = "testing"
        }
        
        annotation {
            ["test.key"] = "test.value"
        }
        
        shareNet = true
        shareIPC = true
        shareUTS = false
        sharePID = false
        
        infraImage = "registry.redhat.io/ubi8/pause:latest"
        
        podmanArgs { "--log-level=debug"; "--cgroup-manager=systemd" }
    }
    
    install = new {
        wantedBy = "multi-user.target"
    }
}

local simplePod = new Pod {
    pod = new {
        podName = "simple-pod"
    }
}

examples {
    ["full pod quadlet"] {
        fullPod.output.text
    }
    
    ["simple pod quadlet"] {
        simplePod.output.text
    }
}
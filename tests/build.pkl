amends "pkl:test"

import "../Build.pkl"

local fullBuild = new Build {
    unit = new {
        description = "Test Build"
        after = "network.target"
    }
    
    build = new {
        imageTag = "localhost/test:latest"
        file = "/app/Containerfile"
        setWorkingDirectory = "/app"
        network = "host"
        pull = "always"
        
        buildArg {
            ["NODE_VERSION"] = "18"
            ["ENV"] = "test"
        }
        
        environment {
            ["BUILDKIT_PROGRESS"] = "plain"
            ["DOCKER_BUILDKIT"] = "1"
        }
        
        label {
            ["app"] = "test"
            ["version"] = "1.0.0"
        }
        
        annotation {
            ["org.example.key"] = "value"
        }
        
        secret = new Listing {
            "id=token,src=/run/secrets/token"
        }
        
        volume = new Listing {
            "/cache:/cache:Z"
        }
        
        arch = "amd64"
        target = "production"
        
        // New fields from comprehensive Build section
        dns = new Listing {
            "8.8.8.8"
            "1.1.1.1"
        }
        
        dnsOption = new Listing {
            "ndots:2"
        }
        
        authFile = "/etc/containers/auth.json"
        
        globalArgs = new Listing {
            "--log-level=debug"
        }
        
        forceRm = true
        tlsVerify = true
        
        podmanArgs {
            "--retry=3"
            "--retry-delay=5s"
            "--rm"
            "--squash=false"
        }
    }
    
    install = new {
        wantedBy = "multi-user.target"
    }
}

local simpleBuild = new Build {
    build = new {
        imageTag = "localhost/simple:latest"
        file = "./Containerfile"
    }
}

examples {
    ["full build quadlet"] {
        fullBuild.output.text
    }
    
    ["simple build quadlet"] {
        simpleBuild.output.text
    }
}